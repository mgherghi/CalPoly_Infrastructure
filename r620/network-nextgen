ethtool -L enp66s0 rx 16 tx 16

# SETUP MTU
ip link set enp66s0 mtu 9000
ip link set enp66s0 up


# SETUP DRBD REPLICATION
ip link add link enp66s0 name rdma type vlan id 10
ip link set dev rdma type vlan egress-qos-map 0:3 1:3 2:3 3:3 4:3 5:3 6:3 7:3
ip link set rdma mtu 9000
ip link set rdma up
ip addr add 4.1.0.6/24 dev rdma
#ip route flush dev rdma
#ip route del default dev nfs 2>/dev/null || true
#ip route add prohibit 0.0.0.0/0 dev nfs metric 50

# Setup NFS Share
ip link add link mlnx-bond name nfs type vlan id 15
ip link set nfs mtu 9000
ip link set nfs up
ip addr add 4.115.0.6/24 dev nfs 


# SETUP LINSTOR MGMT 
ip link add link enp66s0 name linstor-mgmt type vlan id 20
ip link set linstor-mgmt mtu 9000 
ip link set linstor-mgmt up
ip addr add 4.2.0.6/24 dev linstor-mgmt

# SETUP OVN NETWORK
ip link add link enp66s0 name ovn-mgmt type vlan id 30
ip link set ovn-mgmt mtu 9000
ip link set ovn-mgmt up
ip addr add 4.3.0.6/24 dev ovn-mgmt

# SETUP INCUS NETWORK
ip link add link enp66s0 name incus-mgmt type vlan id 40
ip link set incus-mgmt mtu 9000
ip link set incus-mgmt up
ip addr add 4.4.0.6/24 dev incus-mgmt

# Add mlnx-bond in ovs-mlnx OVS bridge
ovs-vsctl --may-exist add-br ovs-mlnx
ovs-vsctl --may-exist add-port ovs-mlnx enp66s0
ovs-vsctl set port enp66s0 trunks=50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200
ovs-vsctl set interface br-int mtu_request=9000
ovs-vsctl set interface ovs-mlnx mtu_request=9000

# Jumbo frames for all geneve interfaces
for i in $(ovs-vsctl --format=csv --data=bare --no-heading --columns=name find interface type=geneve); do
  ovs-vsctl set interface "$i" mtu_request=8950
done

# set transmission queues to 16 for ethernet only (not rdma)
for i in $(ovs-vsctl --format=csv --data=bare --no-heading --columns=name find interface type=geneve); do
  ovs-vsctl set interface "$i" options:n_txq=16
done

# Restart openvswitch
systemctl restart openvswitch-switch

# Bring interfaces up 
ip link set br-int up 
ip link set ovs-mlnx up 

# SETUP INFRA NETWORK vlan 50
# SETUP ADMIN-LABS NETWORK vlan 60
# SETUP BDEBRUHL NETWORK vlan 70
# SETUP HARTMA NETWORK vlan 80
# SETUP BEARD NETWORK vlan 90
# SETUP PHOENIX NETWORK vlan 100
