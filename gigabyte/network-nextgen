# Unload bonding module 
modprobe -r bonding || true

# SETUP MTU
modprobe bonding mode=802.3ad miimon=100
ip link  add mlnx-bond type bond
ip link  set enp65s0f0np0 mtu 9000
ip link  set enp65s0f1np1 mtu 9000
ip link  set mlnx-bond mtu 9000
ip link  set enp65s0f0np0 master mlnx-bond
ip link  set enp65s0f1np1 master mlnx-bond
ip link  set mlnx-bond up

# SETUP DRBD REPLICATION
ip link add link mlnx-bond name rdma type vlan id 10
ip link set rdma mtu 9000
ip link set rdma up
ip addr add 4.1.0.5/24 dev rdma
ip route del default dev rdma 2>/dev/null || true
ip route add prohibit 0.0.0.0/0 dev rdma metric 50

# SETUP LINSTOR MGMT 
ip link add link mlnx-bond name linstor-mgmt type vlan id 20
ip link set linstor-mgmt mtu 9000 
ip link set linstor-mgmt up
ip addr add 4.2.0.5/24 dev linstor-mgmt

# SETUP OVN NETWORK
ip link add link mlnx-bond name ovn-mgmt type vlan id 30
ip link set ovn-mgmt mtu 9000
ip link set ovn-mgmt up
ip addr add 4.3.0.5/24 dev ovn-mgmt

# SETUP INCUS NETWORK
ip link add link mlnx-bond name incus-mgmt type vlan id 40
ip link set incus-mgmt mtu 9000
ip link set incus-mgmt up
ip addr add 4.4.0.5/24 dev incus-mgmt

# SETUP INFRA NETWORK
ip link add link mlnx-bond name infra type vlan id 50
ip link set infra mtu 9000
ip link set infra up

# SETUP ADMIN-LABS NETWORK
ip link add link mlnx-bond name admin-labs type vlan id 60
ip link set admin-labs mtu 9000
ip link set admin-labs up

# SETUP BDEBRUHL NETWORK
ip link add link mlnx-bond name bdebruhl type vlan id 70
ip link set bdebruhl mtu 9000
ip link set bdebruhl up

# SETUP HARTMA NETWORK
ip link add link mlnx-bond name bhartma type vlan id 80
ip link set bhartma mtu 9000
ip link set bhartma up

# SETUP BEARD NETWORK
ip link add link mlnx-bond name sbeard type vlan id 90
ip link set sbeard mtu 9000
ip link set sbeard up

# SETUP PHOENIX NETWORK
ip link add link mlnx-bond name dofang type vlan id 100
ip link set dofang mtu 9000
ip link set dofang up


